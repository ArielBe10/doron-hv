#include "demo/malware.h"
#include "demo/syscall.h"
#include "lib/string.h"
#include "hardware/msr.h"
#include "hardware/registers.h"
#include "lib/logging.h"


void malware(void) {
    hook_ssdt();
    hook_syscall_msrs();
}

void hook_ssdt(void) {
    ssdt.entries[0x123] = evil;
}

void hook_syscall_msrs(void) {
    wrmsr(MSR_IA32_SYSENTER_EIP, (uint64_t)evil);
    wrmsr(MSR_IA32_LSTAR, (uint64_t)evil);
}

void evil(void) {
    INFO("MALWARE!!!!");
}